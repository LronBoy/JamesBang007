<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>微信网页授权</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
</head>
<body>
<h1>微信网页授权</h1>
如果用户在微信客户端中访问第三方网页，公众号可以通过微信网页授权机制，来获取用户基本信息，进而实现业务逻辑。

认证服务号
需要先到公众平台官网中的“开发 - 接口权限 - 网页服务 - 网页帐号 - 网页授权获取用户基本信息”的配置选项中，修改授权回调域名。




<h3>第一步：用户同意授权，获取code</h3>
在确保微信公众账号拥有授权作用域（scope参数）的权限的前提下（服务号获得高级接口后，默认拥有scope参数中的snsapi_base和snsapi_userinfo），引导关注者打开如下页面：





第二步：通过code换取网页授权access_token

获取code
<script type="text/javascript">
//获取url参数
function formatSearch(se){  
    if (typeof se !== "undefined") {      
        se = se.substr(1);
        var arr = se.split("&"),
            obj = {},   
            newarr = [];
        arr.forEach(function(v, i){
          newarr = v.split("=");
          if(typeof obj[newarr[0]] === "undefined"){  
                obj[newarr[0]] = newarr[1];  
            }         
        });
        return obj;
    };  
}
/*
setTimeout(function(){
  var search = formatSearch(window.location.search);
  console.log(search);
  alert(search.code);
},500);
*/
</script>

请求方法

获取code后，请求以下链接获取access_token：  https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&secret=SECRET&code=CODE&grant_type=authorization_code

<div id="code"></div>

<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
var search = formatSearch(window.location.search);
//console.log(search.code);
//alert(search.code);
document.querySelector("#code").innerHTML = search.code;

/*
setTimeout(function(){
  $.ajax({
    type: 'get',
    url: 'https://api.weixin.qq.com/sns/oauth2/access_token?appid=wx35e87e8c5f75fc94&secret=fdb3e6785cf1f0279aba7bc27e0eb358&code='+search.code+'&grant_type=authorization_code',
    success: function(re){    
      console.log(re)
      alert('请求成功：');
      alert(JSON.parse(re));
    },
    error: function(err){
      alert('请求失败：');
    },
    complete: function(){
      alert('请求完成：');
    } 
  });
},500);
*/
</script>









</body>
</html>